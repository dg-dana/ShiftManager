<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Shift Calendar</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- User Management -->
    <section id="user-management">
      <h2>Family Members</h2>
      <div class="user-form">
        <input type="text" id="user-name" placeholder="Enter name">
        <input type="color" id="user-color" value="#FF6B6B">
        <button onclick="addUser()">Add User</button>
      </div>
      <div id="user-list"></div>
      <select id="active-user">
        <option value="">Select User</option>
      </select>
    </section>

    <!-- Shift Templates -->
    <section id="template-management">
      <h2>Shift Templates</h2>
      <div class="template-form">
        <select id="template-user">
          <option value="">Select User</option>
        </select>
        <input type="text" id="template-code" placeholder="Shift Code (e.g., FD)">
        <input type="text" id="template-name" placeholder="Shift Name">
        <input type="time" id="template-start">
        <input type="time" id="template-end">
        <button onclick="addTemplate()">Add Template</button>
      </div>
      <div id="template-list"></div>
    </section>

    <!-- Shift Input -->
    <section id="shift-input">
      <h2>Add Shifts</h2>
      <input type="text" id="shift-text" placeholder="e.g., FD 12.8 or NS 1.9-5.9">
      <button onclick="addShift()">Add Shift</button>
    </section>

    <!-- Calendar -->
    <section id="calendar">
      <h2>Shift Calendar</h2>
      <div class="calendar-controls">
        <button onclick="prevPeriod()">◄</button>
        <span id="calendar-month-year"></span>
        <button onclick="nextPeriod()">►</button>
        <div class="view-toggle">
          <button onclick="setView('month')" class="view-btn active" id="month-view">Month</button>
          <button onclick="setView('week')" class="view-btn" id="week-view">Week</button>
          <button onclick="setView('day')" class="view-btn" id="day-view">Day</button>
        </div>
      </div>
      <div id="calendar-grid"></div>
    </section>

    <!-- Import/Export -->
    <section id="import-export">
      <h2>Backup</h2>
      <input type="file" id="import-file" onchange="importData(event)">
      <button onclick="exportData()">Export Data</button>
    </section>
  </div>

  <!-- Existing scripts -->
  <script src="js/users.js"></script>
  <script src="js/templates.js"></script>
  <script src="js/parser.js"></script>
  <script src="js/calendar.js"></script>
  <script src="js/main.js"></script>

  <!-- Firebase integration -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
    import {
      getAuth,
      signInAnonymously,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBCt2aZOWDLznozrVNTg4OIw7s5WBkx18Y",
      authDomain: "shift-calendar-18355.firebaseapp.com",
      projectId: "shift-calendar-18355",
      storageBucket: "shift-calendar-18355.firebasestorage.app",
      messagingSenderId: "29766311162",
      appId: "1:29766311162:web:11f376db291eae0550bd43",
      measurementId: "G-4PEYYWDTFD"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Sign in anonymously
    signInAnonymously(auth).catch(err => console.error("Anon sign-in failed:", err));

    onAuthStateChanged(auth, user => {
      if (user) {
        console.log("Signed in as:", user.uid);
      }
    });

    // Example Firestore functions — connect these to your existing addUser/addShift later
    window.firebaseAddUser = async function(name, color) {
      if (!name) return;
      await addDoc(collection(db, "users"), {
        name,
        color,
        createdAt: serverTimestamp()
      });
    };

    window.firebaseAddShift = async function(userId, startISO, endISO, note = "") {
      await addDoc(collection(db, "shifts"), {
        userId,
        startTime: startISO,
        endTime: endISO,
        note,
        createdAt: serverTimestamp()
      });
    };

    // Example: Realtime listener for shifts (update your UI here)
    const shiftsQuery = query(collection(db, "shifts"), orderBy("createdAt", "desc"));
    onSnapshot(shiftsQuery, snapshot => {
      const listEl = document.getElementById("shiftsList");
      if (!listEl) return;
      listEl.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.userId} — ${data.startTime} → ${data.endTime} (${data.note || ""})`;
        listEl.appendChild(li);
      });
    });
  </script>
  <div id="debug-console" style="background:#111; color:#0f0; font-family:monospace; padding:10px; height:150px; overflow:auto; font-size:12px;">
  Debug console:
</div>
</body>
</html>
